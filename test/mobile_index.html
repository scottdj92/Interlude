<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
	 <meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=0.5">
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 8%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
	  #fire_btn { font-size:250%; display:block; margin:auto; max-width: 400px; margin-top:40%; padding:2%; }
    </style>
	<script src="/socket.io/socket.io.js"></script>
	<script src="//code.jquery.com/jquery-2.1.3.min.js"></script>
	<script>
		window.onload = function(){
			// create new instance of socket.io
			var num = Math.floor(Math.random()*10);
			var name ='user'+num;

			var red = Math.floor(Math.random() * 255);
			var green = Math.floor(Math.random() * 255);
			var blue = Math.floor(Math.random() * 255);
			var col = 'rgb('+red+','+green+','+blue+')';
			var startRot = undefined;
			//setting client's own properties (MIGHT NOT BE THE BEST PRACTICE);
			var socket = io.connect( window.location.origin);
			
			// we can apply more unique properties like "Name"
			var connectData = { id: num, color: col};
			
			// JOIN GAME
			socket.emit('player join', connectData);
			
			// LEAVE GAME 
			/*this.onbeforeunload = function(){
				alert(num);
				return socket.emit('disconnect', num); //sends player id to server when closed
			}*/

			// Movement
			if (window.DeviceOrientationEvent) {
				window.addEventListener('deviceorientation', function(e) {
				// gamma is the left-to-right tilt in degrees, where right is positive
				var xTilt = e.gamma;
				// beta is the front-to-back tilt in degrees, where front is positive
				var yTilt = e.beta;
				// alpha is the compass direction the device is facing in degrees
				var rot = e.alpha;
				//if(startRot === undefined)
					//startRot = rot;
				//var rot2 = rot - startRot;
				var data = { id: num, xAcc : xTilt, yAcc : yTilt, rot: rot};
								socket.emit('phone tilt', data);
							}, false);
			}
			
			$('#codeform').submit(function(){
				connectData.pw = document.getElementsByName('pw_input').value;
				// JOIN GAME
				socket.emit('player join', connectData);
			})
			
			$("#fire_btn").on('touch click', function(){
				var data = {id:num};
				socket.emit('game fire', data);
			})
		};
	</script>
  </head>
  <body>
	<!--  
	<h2>Enter Room Code:</h2>
	<form id='codeform'>
		<input type='text' name='pw_input' maxlength='8'  placeholder='Enter code here'/>
		<submit name='submit'>Enter</submit>
	</form>
	-->
	<button id="fire_btn">Shoot Peter</button>
  </body>
</html>
